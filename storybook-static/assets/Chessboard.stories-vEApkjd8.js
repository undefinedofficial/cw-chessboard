import{f as ee}from"./index-hDuQWaC9.js";import{d as ue,b as C,o as K,e as I,f as P,F as te,g as oe,n as M,j as fe,t as ne,k as D,l as Y,m as U,p as ce,w as re,q as x,s as _,u as W,v as G,x as pe}from"./vue.esm-bundler-DxSpAh-4.js";const me={key:0,class:"chessboard-coords"},de=ue({__name:"ChessboardCoords",props:{orientation:{},coordMode:{},coordOutside:{type:Boolean}},setup(n){const r=n,s=C(()=>r.coordMode!=="none"),e=C(()=>r.coordMode==="right");return(a,o)=>s.value?(K(),I("div",me,[P("div",{class:M(["coords numbers",{outside:a.coordOutside,"coords-right":e.value}])},[(K(),I(te,null,oe(8,t=>P("span",{class:M(["coord",t%2!==(e.value?1:0)?"white":"black"])},[P("span",null,ne(a.orientation==="w"?9-t:t),1)],2)),64))],2),P("div",{class:M(["coords letters",{outside:a.coordOutside,"coords-right":e.value}])},[(K(),I(te,null,oe(8,t=>P("span",{class:M(["coord",t%2===0?"white":"black"])},[P("span",null,ne(String.fromCharCode(a.orientation==="w"?t+96:105-t)),1)],2)),64))],2)])):fe("",!0)}});de.__docgenInfo={exportName:"default",displayName:"ChessboardCoords",description:"",tags:{},props:[{name:"orientation",required:!0,type:{name:"Color"}},{name:"coordMode",required:!0,type:{name:"CoordMode"}},{name:"coordOutside",required:!1,type:{name:"boolean"}}],sourceFiles:["/home/user/projects/chess/cw-chessboard/src/chessboard/components/ChessboardCoords.vue"]};function he(n,r){const s=D(0);let e;function a(){const t=U(r);t&&(e&&clearTimeout(e),e=setTimeout(()=>{const f=U(n);if(!f)return console.warn("cw-chessboard: no element provided for rescale");const{height:p,width:m}=f.getBoundingClientRect();if(t==="width"){s.value=m;return}else if(t==="height"){s.value=p;return}s.value=m<p?m:p,m===0?s.value=p:p===0&&(s.value=m)},10))}let o;return Y(()=>{if(window.ResizeObserver){const t=new ResizeObserver(a);t.observe(U(n)),o=()=>t.disconnect()}else window.addEventListener("resize",a),o=()=>window.removeEventListener("resize",a);a()}),ce(()=>o==null?void 0:o()),{size:s,Rescale:a}}const se=n=>{const r=[],s=n.split(" ")[0].split("/");if(s.length!==8)throw new Error("Invalid fen string");for(let e=0;e<8;e++){let a=0;for(let o=0;o<s[e].length;o++){const t=s[e][o];a=parseInt(t),Number.isNaN(a)?r.push(t):r.push(...Array(a).fill(null))}}return r},g=n=>({x:n%8,y:Math.floor(n/8)}),J=({x:n,y:r})=>8*r+n,F=({x:n,y:r},s)=>s==="b"?{x:7-n,y:7-r}:{x:n,y:r},k=({x:n,y:r})=>String.fromCharCode(n+97)+(8-r).toString();function be(){let n=!1;const r=[];function s(){return n}function e(t){return new Promise((f,p)=>{r.push(()=>t().then(f).catch(p))})}async function a(){if(!n)for(;r.length;)n=!0,await r.shift()(),n=!1;return Promise.resolve()}function o(){r.length=0,n=!1}return{IsRunning:s,run:a,addTask:e,clear:o}}function ve(n,r){const s=n%8,e=Math.floor(n/8),a=r%8,o=Math.floor(r/8);return Math.max(Math.abs(o-e),Math.abs(a-s))}const ye=(n,r)=>{const s=[],e=[];for(let o=0;o<64;o++){const t=n[o],f=r[o];f!==t&&(f&&s.push({piece:f,index:o}),t&&e.push({piece:t,index:o}))}const a=[];return s.forEach(o=>{let t=8,f=null;if(e.forEach(p=>{if(o.piece!==p.piece)return;const m=ve(o.index,p.index);m<t&&(f=p,t=m)}),f==null){a.push({type:0,piece:o.piece,atIndex:o.index});return}e.splice(e.indexOf(f),1),a.push({type:2,piece:o.piece,atIndex:f.index,toIndex:o.index})}),a.push(...e.map(({piece:o,index:t})=>({type:1,piece:o,atIndex:t}))),a};function Pe({fen:n,orientation:r,duration:s,container:e,alphaPiece:a,onChange:o}){let t=[];const f=c=>{const u=t[c];if(!u)return null;const i=u.toLowerCase();return{name:i,color:i===u?"b":"w"}},p=c=>f(J(c));function m(c,u){const i=document.createElement("div"),d=F(c,r.value),l=u.toLowerCase(),b=(l===u?"b":"w")+l;return i.setAttribute("data-square",k(c)),i.setAttribute("data-piece",b),i.classList.add("piece",b),i.style.transform=`translate(${d.x*100}%, ${d.y*100}%)`,i.style.zIndex="1",i}function V(c,u){const i=u.toLowerCase(),d=k(c),l=(i===u?"b":"w")+i;return e.value.querySelector(`[data-piece="${l}"][data-square="${d}"]`)}function j(c,u,i){const d=V(c,u);d?d.style.opacity=i?a.value?"0.5":"0":"1":console.warn("Invalid value for square piece: ",k(c),u,i?"on":"off")}function w(c=se(n.value)){if(e.value==null)return console.warn("container is null");e.value.innerHTML="";for(let u=0;u<c.length;u++){const i=c[u];i&&e.value.appendChild(m(g(u),i))}t=c}re(n,()=>z(t,se(n.value),s.value).then(()=>w())),re(r,()=>z(t,[],s.value).then(()=>z([],t,s.value).then(()=>w(t))));function H(c,u){const i=ye(c,u),d=[];return i.forEach(l=>{const b=g(l.atIndex);switch(l.type){case 2:{const R=V(b,l.piece);if(!R)return;e.value.appendChild(R);const E=F(g(l.atIndex),r.value),O=F(g(l.toIndex),r.value);d.push({type:l.type,element:R,atPoint:{x:E.x*100,y:E.y*100},toPoint:{x:O.x*100,y:O.y*100}});break}case 0:const v=m(b,l.piece);v.style.opacity="0",e.value.appendChild(v);const S=F(g(l.atIndex),r.value);d.push({type:l.type,element:v,atPoint:{x:S.x*100,y:S.y*100}});break;case 1:const B=V(b,l.piece);if(!B)return;d.push({type:l.type,element:B});break}}),o&&o(i.map(({piece:l,type:b,atIndex:v,toIndex:S})=>b===2?{piece:l,from:k(g(v)),to:k(g(S))}:{piece:l,from:k(g(v))})),d}const{IsRunning:A,addTask:T,clear:N,run:L}=be();async function z(c,u,i){const d=T(()=>new Promise(l=>{var R;if(((R=document.hasFocus)==null?void 0:R.call(document))===!1)return l();const b=H(c,u);let v=null,S;function B(E){if(!A()||document.hidden)return l();S||(S=E);const O=E-S;if(O>i)return v&&(cancelAnimationFrame(v),v=null),b.forEach(h=>{h.element.style.zIndex="1",h.type===1&&e.value.removeChild(h.element)}),l();v=requestAnimationFrame(B);const $=Math.min(1,O/i);let q=$<.5?2*$*$:-1+(4-2*$)*$;(isNaN(q)||q>.99)&&(q=1),b.forEach(h=>{switch(h.element.style.zIndex="10",h.type){case 2:h.element.style.transform=`translate(${h.atPoint.x+(h.toPoint.x-h.atPoint.x)*q}%,
                ${h.atPoint.y+(h.toPoint.y-h.atPoint.y)*q}%`;break;case 0:h.element.style.opacity=(Math.round(q*100)/100).toString();break;case 1:h.element.style.opacity=(Math.round((1-q)*100)/100).toString();break}})}v=requestAnimationFrame(B)}));return L(),d}async function y(c,u,i=!1){const d=new Array(...t),l=J(c);if(!d[l])return console.warn("no piece on",k(c));const b=J(u);return d[b]=d[l],d[l]=null,i&&await z(t,d,s.value),t=d,w(d)}function Z(){N()}return Y(w),{redraw:w,getPieceByIndex:f,getPieceByPoint:p,movePiece:y,setAlphaPiece:j,terminate:Z}}const X=ue({__name:"Chessboard",props:{fen:{default:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQ"},orientation:{default:"w"},duration:{default:300},borderSize:{default:12},roundSize:{default:0},fontSize:{default:24},coordOutside:{type:Boolean},coordMode:{default:"left"},alphaPiece:{type:Boolean},boardSet:{default:"default"},pieceSet:{default:"default"},resize:{type:[Boolean,String],default:!0}},emits:["ready","moves"],setup(n,{expose:r,emit:s}){const e=n,a=s,o=D(null),t=D(null),{size:f,Rescale:p}=he(C(()=>o.value.parentElement.parentElement),x(e,"resize")),m=C(()=>f.value/900),V=C(()=>`${f.value}px`),j=C(()=>`${e.roundSize*m.value}px`),w=C(()=>`${e.borderSize*m.value}px`),H=C(()=>`${e.fontSize*m.value}px`),A=x(e,"orientation"),T=D(null),N=Pe({container:T,fen:x(e,"fen"),orientation:A,duration:x(e,"duration"),alphaPiece:x(e,"alphaPiece"),onChange(y){a("moves",y)}}),L=x(e,"boardSet"),z=x(e,"pieceSet");return _("chessboard",t),_("orientation",A),_("pieces",N),_("boardSet",L),_("pieceSet",z),Y(()=>a("ready")),ce(()=>N.terminate()),r({boardSize:f,Rescale:p,pieces:N}),(y,Z)=>(K(),I("div",{class:M(["cw-chessboard chessboard-theme",L.value]),style:G({width:V.value,height:V.value,fontSize:H.value})},[W(y.$slots,"before"),P("div",{ref_key:"wrapper",ref:o,class:"cw-wrapper",style:G({borderRadius:j.value,borderWidth:w.value})},[P("div",{ref_key:"chessboard",ref:t,class:M(["cw-container",{outside:y.coordOutside}])},[P("div",{ref_key:"piecesContainer",ref:T,class:M(["pieces",z.value])},null,2),W(y.$slots,"default")],2)],4),pe(de,{style:G({margin:w.value}),coordMode:y.coordMode,orientation:y.orientation,coordOutside:y.coordOutside},null,8,["style","coordMode","orientation","coordOutside"]),W(y.$slots,"after")],6))}});X.__docgenInfo={exportName:"default",displayName:"Chessboard",description:"",tags:{},expose:[{name:"boardSize"},{name:"Rescale"},{name:"pieces"}],props:[{name:"fen",required:!1,type:{name:"string"},defaultValue:{func:!1,value:'"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQ"'}},{name:"orientation",required:!1,type:{name:"Color"},defaultValue:{func:!1,value:'"w"'}},{name:"duration",required:!1,type:{name:"number"},defaultValue:{func:!1,value:"300"}},{name:"borderSize",required:!1,type:{name:"number"},defaultValue:{func:!1,value:"12"}},{name:"roundSize",required:!1,type:{name:"number"},defaultValue:{func:!1,value:"0"}},{name:"fontSize",required:!1,type:{name:"number"},defaultValue:{func:!1,value:"24"}},{name:"coordOutside",required:!1,type:{name:"boolean"}},{name:"coordMode",required:!1,type:{name:"CoordMode"},defaultValue:{func:!1,value:'"left"'}},{name:"alphaPiece",required:!1,type:{name:"boolean"}},{name:"boardSet",required:!1,type:{name:"string"},defaultValue:{func:!1,value:'"default"'}},{name:"pieceSet",required:!1,type:{name:"string"},defaultValue:{func:!1,value:'"default"'}},{name:"resize",required:!1,type:{name:"ChessboardResize"},defaultValue:{func:!1,value:"true"}}],events:[{name:"ready"},{name:"moves",type:{names:["Array"],elements:[{name:"ChangeEvent"}]}}],slots:[{name:"before"},{name:"default"},{name:"after"}],sourceFiles:["/home/user/projects/chess/cw-chessboard/src/chessboard/Chessboard.vue"]};const ge={title:"Chessboard",component:X,argTypes:{fen:{control:"text",defaultValue:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"},orientation:{control:"select",options:["w","b"]},coordMode:{control:"select",options:["none","left","right"]},duration:{control:"number",defaultValue:150},borderSize:{control:"number",defaultValue:12},roundSize:{control:"number",defaultValue:12},fontSize:{control:"number",defaultValue:32},coordOutside:{control:"boolean",defaultValue:!1},alphaPiece:{control:"boolean",defaultValue:!1},boardSet:{control:"select",options:["default","blue","green","sport"]},pieceSet:{control:"select",options:["default","grady","staunty","stock"]},resize:{control:"select",options:[!1,!0,"width","height"]},onMoves:ee,onReady:ee},args:{fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",orientation:"w",coordMode:"left",duration:250,borderSize:1,roundSize:12,fontSize:32,boardSet:"default",pieceSet:"default"},tags:["autodocs"],render:n=>({components:{Chessboard:X},setup(){return{args:n}},template:'<div style="width: 90vw; height: 90vh"><chessboard v-bind="args"/></div>'})},Q={args:{}};var ae,le,ie;Q.parameters={...Q.parameters,docs:{...(ae=Q.parameters)==null?void 0:ae.docs,source:{originalSource:`{
  args: {}
}`,...(ie=(le=Q.parameters)==null?void 0:le.docs)==null?void 0:ie.source}}};const Ce=["View"];export{Q as View,Ce as __namedExportsOrder,ge as default};
