var ve=Object.defineProperty;var Se=(r,a,l)=>a in r?ve(r,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[a]=l;var Y=(r,a,l)=>(Se(r,typeof a!="symbol"?a+"":a,l),l);import{f as re}from"./index-xCDV934R.js";import{d as de,b as P,o as K,e as W,f as C,F as se,g as ae,n as B,j as H,k as we,t as ie,l as I,m as fe,p as Z,q as ge,s as Pe,u as ze,v as ee,w as Ce,x as te,y as ke}from"./vue.esm-bundler-o7EOod-B.js";const pe=de({__name:"ChessboardCoords",props:{orientation:{},coordMode:{},borderScale:{},coordOutside:{type:Boolean}},setup(r){const a=r,l=P(()=>a.coordMode!=="none"),e=P(()=>a.coordMode==="right");return(c,s)=>l.value?(K(),W("div",{key:0,class:"chessboard-coords",style:H({margin:c.borderScale})},[C("div",{class:B(["coords numbers",{outside:c.coordOutside,"coords-right":e.value}])},[(K(),W(se,null,ae(8,t=>C("span",{class:B(["coord",t%2!==(e.value?1:0)?"white":"black"])},[C("span",null,ie(c.orientation==="w"?9-t:t),1)],2)),64))],2),C("div",{class:B(["coords letters",{outside:c.coordOutside,"coords-right":e.value}])},[(K(),W(se,null,ae(8,t=>C("span",{class:B(["coord",t%2===0?"white":"black"])},[C("span",null,ie(String.fromCharCode(c.orientation==="w"?t+96:105-t)),1)],2)),64))],2)],4)):we("",!0)}});pe.__docgenInfo={exportName:"default",displayName:"ChessboardCoords",description:"",tags:{},props:[{name:"orientation",required:!0,type:{name:"Color"}},{name:"coordMode",required:!0,type:{name:"CoordMode"}},{name:"borderScale",required:!0,type:{name:"string"}},{name:"coordOutside",required:!1,type:{name:"boolean"}}],sourceFiles:["/home/user/projects/cw-chessboard/src/chessboard/components/ChessboardCoords.vue"]};function xe(r,a){const l=I(0);let e;function c(){const t=Z(a);t&&(e&&clearTimeout(e),e=setTimeout(()=>{const b=Z(r);if(!b)return console.warn("cw-chessboard: no element provided for rescale");const{height:f,width:v}=b.getBoundingClientRect();if(t==="width"){l.value=v;return}else if(t==="height"){l.value=f;return}l.value=v<f?v:f,v===0?l.value=f:f===0&&(l.value=v)},10))}let s;return fe(()=>{if(window.ResizeObserver){const t=new ResizeObserver(c);t.observe(Z(r)),s=()=>t.disconnect()}else window.addEventListener("resize",c),s=()=>window.removeEventListener("resize",c);c()}),ge(()=>s==null?void 0:s()),{size:l,Rescale:c}}const qe=r=>{const a=[],l=r.split(" ")[0].split("/");if(l.length!==8)throw new Error("Invalid fen string");for(let e=0;e<8;e++){let c=0;for(let s=0;s<l[e].length;s++){const t=l[e][s];c=parseInt(t),Number.isNaN(c)?a.push(t):a.push(...Array(c).fill(null))}}return a},M=r=>({x:r%8,y:Math.floor(r/8)}),ne=({x:r,y:a})=>8*a+r,Q=({x:r,y:a},l)=>l==="b"?{x:7-r,y:7-a}:{x:r,y:a},E=({x:r,y:a})=>String.fromCharCode(r+97)+(8-a).toString();class Me{constructor(){Y(this,"isRunning");Y(this,"tasks");this.isRunning=!1,this.tasks=[]}get IsRunning(){return this.isRunning}get Size(){return this.tasks.length}addTask(a){return new Promise((l,e)=>{this.tasks.push(()=>a().then(l).catch(e)),this.run()})}async run(){if(!this.isRunning){for(this.isRunning=!0;this.tasks.length;)await this.tasks.shift()();this.isRunning=!1}}clear(){this.tasks.length=0,this.isRunning=!1}}function Re(r,a){const l=r%8,e=Math.floor(r/8),c=a%8,s=Math.floor(a/8);return Math.max(Math.abs(s-e),Math.abs(c-l))}const Ve=(r,a)=>{const l=[],e=[];for(let s=0;s<64;s++){const t=r[s],b=a[s];b!==t&&(b&&l.push({piece:b,index:s}),t&&e.push({piece:t,index:s}))}const c=[];return l.forEach(s=>{let t=8,b=null;if(e.forEach(f=>{if(s.piece!==f.piece)return;const v=Re(s.index,f.index);v<t&&(b=f,t=v)}),b==null){c.push({type:0,piece:s.piece,atIndex:s.index});return}e.splice(e.indexOf(b),1),c.push({type:2,piece:s.piece,atIndex:b.index,toIndex:s.index})}),c.push(...e.map(({piece:s,index:t})=>({type:1,piece:s,atIndex:t}))),c};function Ae({onOrientationChange:r,onChange:a,onRenderPiece:l}){let e=null,c="",s=200,t="w",b=!1,f=[],v="all";const R=n=>{const p=f[n];if(!p)return null;const u=p.toLowerCase();return{name:u,color:u===p?"b":"w"}},L=n=>R(ne(n));function T(n,p,u){const o=document.createElement("piece"),d=Q(n,u),i=p.toLowerCase(),h=i===p?"b":"w",g=h+i,z=E(n);o.setAttribute("data-square",z),o.setAttribute("data-piece",g),o.setAttribute("data-color",h),o.classList.add("piece",g),o.style.transform=`translate3d(${d.x*100}%,${d.y*100}%,0px)`,o.style.zIndex="5",o.style.opacity="1",o.style.display=v==="all"||v===h?"block":"none";const x=l==null?void 0:l(z,p,h);return x&&o.classList.add(x),o}function N(n,p){const u=p.toLowerCase(),o=E(n),d=(u===p?"b":"w")+u;return e==null?void 0:e.querySelector(`[data-piece="${d}"][data-square="${o}"]`)}function D(n,p,u){const o=N(n,p);o?o.style.opacity=u?b?"0.5":"0":"1":console.warn("Invalid value for square piece: ",E(n),p,u?"on":"off")}let O=!1;function V(n,p,u=!1){if(!e)return console.warn("container is null");if(!(O&&!u)){e.innerHTML="";for(let o=0;o<n.length;o++){const d=n[o];d&&e.appendChild(T(M(o),d,p))}f=n,O=!0}}function U(n,p,u){const o=Ve(n,p),d=[];return o.forEach(i=>{const h=M(i.atIndex);switch(i.type){case 2:{const $=N(h,i.piece);if(!$)return;e.appendChild($);const F=Q(M(i.atIndex),u),q=Q(M(i.toIndex),u);d.push({type:i.type,element:$,atPoint:{x:F.x*100,y:F.y*100},toPoint:{x:q.x*100,y:q.y*100}});break}case 0:const g=T(h,i.piece,u);g.style.opacity="0",g.style.display="block",e.appendChild(g);const z=Q(M(i.atIndex),u);d.push({type:i.type,element:g,atPoint:{x:z.x*100,y:z.y*100}});break;case 1:const x=N(h,i.piece);if(!x)return;d.push({type:i.type,element:x});break}}),a&&a(o.map(({piece:i,type:h,atIndex:g,toIndex:z})=>h===2?{piece:i,from:E(M(g)),to:E(M(z))}:{piece:i,from:E(M(g))})),d}const y=new Me;function k(n,p,u,o){return new Promise(d=>{var x;if(((x=document.hasFocus)==null?void 0:x.call(document))===!1||!e)return d();const i=U(n,p,o);let h=null,g;function z($){if(!y.IsRunning||document.hidden)return d();O=!1,g||(g=$);const F=$-g;if(F>u){h&&(cancelAnimationFrame(h),h=null);for(const w of i)w.element.style.zIndex="5",w.type===1&&w.element.parentNode&&e.removeChild(w.element);d();return}h=requestAnimationFrame(z);const q=Math.min(1,F/u);let A=q<.5?2*q*q:-1+(4-2*q)*q;(isNaN(A)||A>.99)&&(A=1),i.forEach(w=>{switch(w.element.style.zIndex="15",w.type){case 2:{const ye=w.atPoint.x+(w.toPoint.x-w.atPoint.x)*A,be=w.atPoint.y+(w.toPoint.y-w.atPoint.y)*A;w.element.style.transform=`translate3d(${ye}%,${be}%,0px)`;break}case 0:w.element.style.opacity=(Math.round(A*100)/100).toString();break;case 1:w.element.style.opacity=(Math.round((1-A)*100)/100).toString();break}})}h=requestAnimationFrame(z)})}function S(){y.clear()}function m(n){e=n}async function _(n,p,u=!1){const o=new Array(...f),d=ne(n);if(!o[d])return console.warn("no piece on",E(n));const i=ne(p);o[i]=o[d],o[d]=null;let h=u?s:0;return y.Size>0&&(h=h/(1+Math.pow(y.Size/5,2))),y.addTask(()=>k(new Array(...f),o,h,t)).then(()=>V(o,t,!0))}async function G(n,p=!1){if(n===c)return;c=n;const u=qe(c);let o=p?s:0;return y.Size>0&&(o=o/(1+Math.pow(y.Size/5,2))),y.addTask(()=>k([...f],u,o,t).then(()=>V(u,t,!0)))}async function J(n,p=!1){if(n===t)return;t=n;let u=p?s:0;y.Size>0&&(u=u/(1+Math.pow(y.Size/5,2)));const o=y.addTask(()=>k(new Array(...f),[],u,t)),d=y.addTask(()=>k([],new Array(...f),u,t).then(()=>V(f,t,!0)));return Promise.all([o.then(()=>r==null?void 0:r(t)),d])}function X(n){s=n}function me(n){b=n}async function he(n,p=!1){if(v===n)return;let u=p?s:0;y.Size>0&&(u=u/(1+Math.pow(y.Size/5,2)));let o=v==="none"?new Array(64).fill(null):[...f],d;return n==="all"?(o=new Array(64).fill(null),d=[...f]):n==="none"?d=new Array(64).fill(null):n==="w"?d=f.map(i=>(i==null?void 0:i.toUpperCase())===i?i:null):n==="b"&&(d=f.map(i=>(i==null?void 0:i.toLowerCase())===i?i:null)),v=n,y.addTask(()=>k(o,d,u,t).then(()=>V(f,t,!0)))}return{getPieceByIndex:R,getPieceByPoint:L,movePiece:_,setAlphaPiece:D,setFen:G,setDuration:X,setOrientation:J,setIsAlphaPiece:me,setContainer:m,setVisibility:he,terminate:S}}function Ee(r){return[e=>Pe(r,e),()=>{const e=ze(r);if(e===void 0)throw new Error(`Provider "${r}" not found.`);return e}]}const[Be,Oe]=Ee("chessboard-context"),oe=de({__name:"Chessboard",props:{fen:{},orientation:{default:"w"},duration:{default:300},borderSize:{default:12},roundSize:{default:0},fontSize:{default:24},coordOutside:{type:Boolean},coordMode:{default:"left"},alphaPiece:{type:Boolean},boardSet:{default:"default"},pieceSet:{default:"default"},pieceWhiteSet:{},pieceBlackSet:{},resize:{type:[Boolean,String],default:!0},visibility:{default:"all"},onRenderPiece:{}},emits:["ready","moves"],setup(r,{expose:a,emit:l}){const e=r,c=l,s=I(),t=()=>s.value,b=I(),{size:f,Rescale:v}=xe(P(()=>s.value.parentElement),ee(e,"resize")),R=P(()=>f.value/900),L=P(()=>e.fontSize*R.value),T=P(()=>L.value/1.5<e.borderSize),N=P(()=>!e.coordOutside||T.value?`${(e.borderSize*R.value).toFixed(2)}px`:`${((T.value?e.borderSize:e.fontSize/1.5)*R.value).toFixed(2)}px`),D=P(()=>`${e.roundSize*R.value}px`),O=P(()=>({borderRadius:D.value,borderWidth:N.value,...T.value?{}:{borderColor:"transparent",backgroundColor:"transparent"}})),V=P(()=>`${f.value}px`),U=P(()=>`${L.value.toFixed(3)}px`),y=I(e.orientation),k=I(null),S=Ae({onChange(m){c("moves",m)},onOrientationChange(m){y.value=m},onRenderPiece:e.onRenderPiece});return Ce(e,async({fen:m,orientation:_,alphaPiece:G,duration:J,visibility:X})=>{m&&S.setFen(m,!0),S.setOrientation(_,!0),S.setVisibility(X,!0),S.setIsAlphaPiece(G),S.setDuration(J)},{deep:!0}),Be({container:s,chessboard:b,orientation:y,pieces:S,boardSet:ee(e,"boardSet"),pieceSet:ee(e,"pieceSet")}),fe(()=>{S.setContainer(k.value),S.setDuration(e.duration),e.fen&&S.setFen(e.fen),S.setOrientation(e.orientation),S.setVisibility(e.visibility),S.setIsAlphaPiece(e.alphaPiece),c("ready",S)}),a({getElement:t,boardSize:f,Rescale:v,pieces:S}),(m,_)=>(K(),W("div",{ref_key:"container",ref:s,class:B(["cw-chessboard chessboard-theme",m.boardSet]),style:H({width:V.value,height:V.value,fontSize:U.value})},[te(m.$slots,"before"),C("div",{class:"cw-wrapper",style:H(O.value)},[C("div",{ref_key:"chessboard",ref:b,class:B(["cw-container",{outside:m.coordOutside,contour:m.borderSize>0}]),style:H({borderRadius:D.value})},[te(m.$slots,"default"),C("div",{ref_key:"piecesContainer",ref:k,class:B(["pieces",m.pieceSet])},null,2)],6)],4),ke(pe,{borderScale:N.value,coordMode:m.coordMode,orientation:m.orientation,coordOutside:m.coordOutside},null,8,["borderScale","coordMode","orientation","coordOutside"]),te(m.$slots,"after")],6))}});oe.__docgenInfo={exportName:"default",displayName:"Chessboard",description:"",tags:{},expose:[{name:"getElement"},{name:"boardSize"},{name:"Rescale"},{name:"pieces"}],props:[{name:"fen",required:!1,type:{name:"string"}},{name:"orientation",required:!1,type:{name:"Color"},defaultValue:{func:!1,value:'"w"'}},{name:"duration",required:!1,type:{name:"number"},defaultValue:{func:!1,value:"300"}},{name:"borderSize",required:!1,type:{name:"number"},defaultValue:{func:!1,value:"12"}},{name:"roundSize",required:!1,type:{name:"number"},defaultValue:{func:!1,value:"0"}},{name:"fontSize",required:!1,type:{name:"number"},defaultValue:{func:!1,value:"24"}},{name:"coordOutside",required:!1,type:{name:"boolean"}},{name:"coordMode",required:!1,type:{name:"CoordMode"},defaultValue:{func:!1,value:'"left"'}},{name:"alphaPiece",required:!1,type:{name:"boolean"}},{name:"boardSet",required:!1,type:{name:"string"},defaultValue:{func:!1,value:'"default"'}},{name:"pieceSet",required:!1,type:{name:"string"},defaultValue:{func:!1,value:'"default"'}},{name:"pieceWhiteSet",required:!1,type:{name:"string"}},{name:"pieceBlackSet",required:!1,type:{name:"string"}},{name:"resize",required:!1,type:{name:"ChessboardResize"},defaultValue:{func:!1,value:"true"}},{name:"visibility",required:!1,type:{name:"InputColor"},defaultValue:{func:!1,value:'"all"'}},{name:"onRenderPiece",required:!1,type:{name:"RenderPieceCallback"}}],events:[{name:"ready",type:{names:["ChessboardPieces"]}},{name:"moves",type:{names:["Array"],elements:[{name:"ChangeEvent"}]}}],slots:[{name:"before"},{name:"default"},{name:"after"}],sourceFiles:["/home/user/projects/cw-chessboard/src/chessboard/Chessboard.vue"]};const Fe={title:"Chessboard",component:oe,argTypes:{fen:{control:"text",defaultValue:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"},orientation:{control:"select",options:["w","b"]},coordMode:{control:"select",options:["none","left","right"]},duration:{control:"number",defaultValue:150},borderSize:{control:"number",defaultValue:12},roundSize:{control:"number",defaultValue:12},fontSize:{control:"number",defaultValue:32},coordOutside:{control:"boolean",defaultValue:!1},alphaPiece:{control:"boolean",defaultValue:!1},boardSet:{control:"select",options:["default","blue","green","sport"]},pieceSet:{control:"select",options:["default","grady","staunty","stock"]},resize:{control:"select",options:[!1,!0,"width","height"]},onMoves:re,onReady:re},args:{fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",orientation:"w",coordMode:"left",duration:250,borderSize:1,roundSize:12,fontSize:32,boardSet:"default",pieceSet:"default"},tags:["autodocs"],render:r=>({components:{Chessboard:oe},setup(){return{args:r}},template:'<div style="width: 90vw; height: 90vh"><chessboard v-bind="args"/></div>'})},j={args:{}};var le,ue,ce;j.parameters={...j.parameters,docs:{...(le=j.parameters)==null?void 0:le.docs,source:{originalSource:`{
  args: {}
}`,...(ce=(ue=j.parameters)==null?void 0:ue.docs)==null?void 0:ce.source}}};const Ie=["View"];export{j as View,Ie as __namedExportsOrder,Fe as default};
